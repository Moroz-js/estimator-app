# Система приглашений в проекты

## Что добавлено

1. **Кнопка "Пригласить"** в EstimatorApp (шаг 3 - эпики)
   - Появляется только для сохранённых проектов
   - Открывает prompt для ввода email пользователя
   - Добавляет пользователя в проект с ролью "viewer"
   - Только владелец проекта может приглашать

2. **Раздел "Гостевые проекты"** на главной странице
   - Показывает проекты, в которые пользователь был приглашён
   - Отображает email пригласившего пользователя
   - Визуально отличается от "Моих проектов" (синий фон)
   - Автоматически загружается при входе

3. **API endpoint `/api/invite`**
   - Принимает projectId, email и accessToken
   - Проверяет, что приглашающий - владелец проекта
   - Ищет пользователя по email в базе
   - Добавляет запись в project_members с invited_by
   - Возвращает ошибку, если пользователь не найден или уже добавлен

4. **Обновлённая таблица project_members**
   - Добавлено поле `invited_by` (UUID, ссылка на auth.users)
   - Хранит ID пользователя, который пригласил
   - NULL для владельца проекта
   - Используется для отображения информации о приглашении

## Миграция базы данных

Необходимо выполнить SQL миграцию из файла `supabase_migration_invitations.sql`:

```sql
-- Удаляем is_public, так как теперь используем систему приглашений
ALTER TABLE projects DROP COLUMN IF EXISTS is_public;
DROP INDEX IF EXISTS idx_projects_is_public;

-- Добавляем поле invited_by в project_members
ALTER TABLE project_members 
ADD COLUMN IF NOT EXISTS invited_by UUID REFERENCES auth.users(id);

-- Создаём индекс для быстрого поиска приглашённых проектов
CREATE INDEX IF NOT EXISTS idx_project_members_user_invited 
ON project_members(user_id, invited_by);
```

## Как использовать

### Пригласить пользователя:
1. Откройте свой проект (вы должны быть владельцем)
2. Перейдите на шаг 3 (Эпики и подзадачи)
3. Нажмите кнопку "Пригласить"
4. Введите email пользователя (он должен быть зарегистрирован)
5. Пользователь увидит проект в разделе "Гостевые проекты"

### Просмотреть гостевые проекты:
1. На главной странице прокрутите вниз
2. Раздел "Гостевые проекты" появится, если вас кто-то пригласил
3. Каждая карточка показывает, кто вас пригласил
4. Нажмите на проект, чтобы открыть его

### Роли пользователей:
- **owner** - владелец проекта, может приглашать других
- **viewer** - приглашённый пользователь, может просматривать проект

## Ограничения

- Пользователь должен быть зарегистрирован в системе
- Приглашать может только владелец проекта
- Нельзя пригласить пользователя дважды
- Для поиска пользователей используется service role key (требуется настройка)

## Безопасность

- Проверка прав доступа на уровне API
- Только владелец может приглашать пользователей
- Приглашённые пользователи видят проект в read-only режиме
- Все операции требуют авторизации
