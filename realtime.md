–ù–∏–∂–µ ‚Äî –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –¢–ó, –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –Ω–∞ **–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–º**, –±–µ–∑ —É–ø–æ–º–∏–Ω–∞–Ω–∏–π —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –∏ —Å —è–≤–Ω—ã–º –±–ª–æ–∫–æ–º –ø—Ä–æ –º–∏–≥—Ä–∞—Ü–∏–∏/–ë–î.

---

# **–¢–ó: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Realtime Collaboration + –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Estimator App**

## **1. –¶–µ–ª—å**

–î–æ–±–∞–≤–∏—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É `/project/[id]` —Ä–µ–∂–∏–º —Å–æ–≤–º–µ—Å—Ç–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞, –≤–∫–ª—é—á–∞—é—â–∏–π:

* realtime-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π (—ç–ø–∏–∫–∏, –∑–∞–¥–∞—á–∏, –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ),
* –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π,
* –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —Ä–µ–¥–∞–∫—Ç–∏—Ä—É—é—â–∏—Ö —ç–ø–∏–∫–∏/–∑–∞–¥–∞—á–∏,
* –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ë–î.

–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—å—é `owner`, `editor` –∏–ª–∏ `viewer`.

---

## **2. –û–±–ª–∞—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏—è**

üî¥ **Realtime –ù–ï –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è:**

* –∫ –ø—É–±–ª–∏—á–Ω–æ–º—É –ø—Ä–µ–≤—å—é `/project/[id]/preview`.

üü¢ **Realtime –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ:**

* –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ `/project/[id]`.

üü£ **–ò—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã:**
—Ç–∞–±–ª–∏—Ü–∞ `projects.payload` –≤ Supabase (JSONB).

---

## **3. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏**

### **3.1. Presence (–∫—Ç–æ –≤ –ø—Ä–æ–µ–∫—Ç–µ)**

* –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ `/project/[id]` –∫–ª–∏–µ–Ω—Ç –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ –∫–∞–Ω–∞–ª—É `project:{projectId}`.
* –ö–ª–∏–µ–Ω—Ç –ø—É–±–ª–∏–∫—É–µ—Ç presence (–¥–∞–Ω–Ω—ã–µ –æ —Å–µ–±–µ).
* –í –≤–µ—Ä—Ö–Ω–µ–π –ø–∞–Ω–µ–ª–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –Ω–∞—Ö–æ–¥—è—â–∏—Ö—Å—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ.
* –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ: –∞–≤–∞—Ç–∞—Ä/–∏–Ω–∏—Ü–∏–∞–ª—ã + tooltip —Å email/–∏–º–µ–Ω–µ–º.
* –¶–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—Å–µ–≥–¥–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –¥–ª—è –Ω–µ–≥–æ (—Å–º. 3.4).

### **3.2. –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**

* –£—Ä–æ–≤–µ–Ω—å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ ‚Äî —ç–ø–∏–∫ –∏ –∑–∞–¥–∞—á–∞ (–Ω–µ –ø–æ–ª–µ):

  * –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –ª—é–±–æ–µ –ø–æ–ª–µ –∑–∞–¥–∞—á–∏ ‚Üí –æ–Ω "—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –∑–∞–¥–∞—á—É".
  * –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ —ç–ø–∏–∫–∞ ‚Üí –æ–Ω "—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç —ç–ø–∏–∫".
* –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ presence:

  * `currentEpicId`
  * `currentTaskId`
  * `isTyping`

UI-–ø–æ–≤–µ–¥–µ–Ω–∏–µ:

* –í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ —ç–ø–∏–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —Ä–µ–¥–∞–∫—Ç–∏—Ä—É—é—â–∏–µ —ç–ø–∏–∫ –∏–ª–∏ –ª—é–±—É—é –∑–∞–¥–∞—á—É –≤–Ω—É—Ç—Ä–∏.
* –í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ –∑–∞–¥–∞—á–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —Ä–µ–¥–∞–∫—Ç–∏—Ä—É—é—â–∏–µ –∑–∞–¥–∞—á—É.

### **3.3. Realtime-—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**

* –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç **–ª–æ–∫–∞–ª—å–Ω–æ —Å—Ä–∞–∑—É** (–æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω–æ).
* –ü–æ—Å–ª–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è patch-—Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Realtime-–∫–∞–Ω–∞–ª.
* –£ –¥—Ä—É–≥–∏—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è patch –∫ –ª–æ–∫–∞–ª—å–Ω–æ–º—É state.
* –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Ä–∞–∑—Ä–µ—à–∞—é—Ç—Å—è –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É **Last Write Wins (timestamp)**.

### **3.4. –¶–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

* –¶–≤–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è **–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ `userId`**.
* –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è: `hash(userId) % USER_COLORS.length`.
* –ü–∞–ª–∏—Ç—Ä–∞ —Å—Ç—Ä–æ–≥–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞:

```ts
const USER_COLORS = [
  "#1f77b4", "#ff7f0e", "#2ca02c", "#d62728", "#9467bd",
  "#8c564b", "#e377c2", "#7f7f7f", "#bcbd22", "#17becf",
];
```

### **3.5. –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î**

* –ü—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è ‚Üí —Å—Ç–∞–≤–∏—Ç—Å—è —Ñ–ª–∞–≥ `hasUnsavedChanges = true`.
* –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è debounce-—Ç–∞–π–º–µ—Ä –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (10 —Å–µ–∫).
* –ü–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Ç–∞–π–º–µ—Ä–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –≤ –ë–î.

  * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ—Ç –∂–µ endpoint, —á—Ç–æ –∫–Ω–æ–ø–∫–∞ ‚Äú–°–æ—Ö—Ä–∞–Ω–∏—Ç—å‚Äù.
* –í —Å–ª—É—á–∞–µ —Ä—É—á–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–Ω–æ–ø–∫–æ–π:

  * —Ç–∞–π–º–µ—Ä —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ.

### **3.6. –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è**

* –ü—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è Realtime ‚Üí UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ –ø–æ—Ç–µ—Ä—è–Ω–Ω–æ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏.
* –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ **–ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å** (—á–µ—Ä–µ–∑ HTTP API).
* –ü–æ—Å–ª–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è Realtime:

  * –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–ø–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã** (reload),
  * state –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ –∏–∑ –ë–î.

---

## **4. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Realtime-—Å–ª–æ—è**

### **4.1. –ö–∞–Ω–∞–ª**

* –ò–º—è –∫–∞–Ω–∞–ª–∞: `project:{projectId}`.
* –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: Presence + Broadcast.

### **4.2. –§–æ—Ä–º–∞—Ç Presence Payload**

```ts
interface PresencePayload {
  userId: string;
  email: string;
  displayName?: string;
  color: string;
  joinedAt: string;
  currentEpicId?: string;
  currentTaskId?: string;
  isTyping?: boolean;
}
```

### **4.3. –¢–∏–ø—ã Patch-—Å–æ–æ–±—â–µ–Ω–∏–π**

```ts
type RealtimeEventType =
  | "project_meta_update"
  | "epic_create"
  | "epic_update"
  | "epic_delete"
  | "epic_reorder"
  | "task_create"
  | "task_update"
  | "task_delete"
  | "task_reorder";

interface RealtimeBaseMessage {
  type: RealtimeEventType;
  clientId: string;
  userId: string;
  timestamp: number;
}
```

#### **–ü—Ä–∏–º–µ—Ä: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏**

```ts
interface TaskUpdateMessage extends RealtimeBaseMessage {
  type: "task_update";
  epicId: string;
  taskId: string;
  payload: Partial<Subtask>;
}
```

### **4.4. –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–µ**

* –ï—Å–ª–∏ –≤—Ö–æ–¥—è—â–∏–π patch –∏–º–µ–µ—Ç `timestamp >= lastAppliedTimestamp`, –æ–Ω –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è.
* –õ–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –æ—Ç–º–µ–Ω—è—é—Ç—Å—è, –Ω–æ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω—ã —á—É–∂–∏–º–∏ –ø—Ä–∏ –ø–æ—Å–ª–µ–¥—É—é—â–µ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.

---

## **5. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–ª–∏–µ–Ω—Ç–∞—Ö**

### **5.1. –ù–æ–≤—ã–π —Ö—É–∫ `useProjectRealtime`**

–ü—É—Ç—å: `src/lib/useProjectRealtime.ts`

**–ó–∞–¥–∞—á–∏:**

* –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–∞–Ω–∞–ª—É,
* –ø—É–±–ª–∏–∫–∞—Ü–∏—è presence,
* –ø–æ–ª—É—á–µ–Ω–∏–µ presence,
* –æ—Ç–ø—Ä–∞–≤–∫–∞ patch,
* –ø–æ–ª—É—á–µ–Ω–∏–µ patch,
* –¥–µ—Ç–µ–∫—Ü–∏—è —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–∞ –∏ –≤—ã–∑–æ–≤ reload.

### **5.2. –ù–æ–≤—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä `ProjectCollabProvider`**

–ü—É—Ç—å: `src/components/ProjectCollabProvider.tsx`

**–ó–∞–¥–∞—á–∏:**

* —Ö—Ä–∞–Ω–µ–Ω–∏–µ presence,
* –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ:

  * `editingByEpicId: Record<string, PresencePayload[]>`
  * `editingByTaskId: Record<string, PresencePayload[]>`
* –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π `sendPatch`, `updatePresence`.

### **5.3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `EstimatorApp`**

–ò–∑–º–µ–Ω–µ–Ω–∏—è:

* –≤—Å–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–ø–µ—Ä—å –≤—ã–∑—ã–≤–∞—é—Ç `sendPatch`.
* –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (debounce 10 —Å–µ–∫).
* –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è.
* —Ñ–ª–∞–≥ `hasUnsavedChanges`.

### **5.4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `EpicEditor`**

* –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ `editingByEpicId`, `editingByTaskId`.
* –≤—ã–∑–æ–≤—ã `updatePresence` –ø—Ä–∏ focus/blur.

---

## **6. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ë–î –∏ –º–∏–≥—Ä–∞—Ü–∏—è–º**

### üìå **–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**

* Realtime –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö.
* –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–ª—å–∫–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã `projects` –∏ `project_members`.
* –ù–∏–∫–∞–∫–∏—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –≤ –ë–î –≤—ã–ø–æ–ª–Ω—è—Ç—å –Ω–µ –Ω—É–∂–Ω–æ.

### üìå **–ú–∏–≥—Ä–∞—Ü–∏–∏**

```sql
-- Realtime collaboration does not require changes to the database schema.
-- No migrations required.
```

---

## **7. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**

* –ù–∏–∫–∞–∫–æ–π realtime –≤ –ø—É–±–ª–∏—á–Ω–æ–º –ø—Ä–µ–≤—å—é.
* –ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π ¬´X joined / X left¬ª.
* –ù–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –ø–æ–ª–µ–π (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–ø—É—Å–∫–∞—é—Ç—Å—è).
* –í —Å–ª—É—á–∞–µ –±–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è ‚Äî –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è.

---

## **8. Post-Deployment**

* Realtime –≤–∫–ª—é—á—ë–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è –≤—Å–µ—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤.
* –î–æ—Å—Ç—É–ø –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ç–æ–π –∂–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π, —á—Ç–æ –∏ –¥–æ—Å—Ç—É–ø –∫ `/project/[id]`.




---

## 11. –£—Ç–æ—á–Ω–µ–Ω–∏—è –∏ —Ä–µ—à–µ–Ω–∏—è –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 11.1. Timestamp –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

**–†–µ—à–µ–Ω–∏–µ:** –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–¥–Ω–æ–≥–æ timestamp –Ω–∞ –≤—Å—é —Å—É—â–Ω–æ—Å—Ç—å:
- –î–ª—è `Epic` ‚Äî `epicLastModified[epicId]: number`
- –î–ª—è `Subtask` ‚Äî `taskLastModified[taskId]: number`
- –î–ª—è `ProjectMeta` ‚Äî –æ–¥–∏–Ω –æ–±—â–∏–π timestamp

–•—Ä–∞–Ω–∏—Ç—å **—Ç–æ–ª—å–∫–æ –≤ –ø–∞–º—è—Ç–∏ –∫–ª–∏–µ–Ω—Ç–∞**, –≤ —Å–ª—É–∂–µ–±–Ω—ã—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–Ω—É—Ç—Ä–∏ —Ö—É–∫–∞/–∫–æ–Ω—Ç–µ–∫—Å—Ç–∞), **–ù–ï –≤ `AppState` –∏ –Ω–µ –≤ –ë–î**.

### 11.2. clientId –≥–µ–Ω–µ—Ä–∞—Ü–∏—è

**–†–µ—à–µ–Ω–∏–µ:** `clientId` –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã `/project/[id]`:
- `const clientId = crypto.randomUUID()`
- –•—Ä–∞–Ω–∏—Ç—å –≤ `useRef`, —á—Ç–æ–±—ã –∂–∏—Ç—å –≤–µ—Å—å –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Äî –Ω–æ–≤—ã–π `clientId` (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)

### 11.3. –û–±—Ä–∞–±–æ—Ç–∫–∞ reorder —Å–æ–±—ã—Ç–∏–π

**–†–µ—à–µ–Ω–∏–µ:** –î–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º **–ø–æ–ª–Ω—ã–π –º–∞—Å—Å–∏–≤ ID –≤ –Ω–æ–≤–æ–º –ø–æ—Ä—è–¥–∫–µ**.

–†–µ–∞–ª–∏–∑—É–µ–º –≤ —Ä–∞–º–∫–∞—Ö —ç—Ç–æ–π –∑–∞–¥–∞—á–∏ –∏ –¥–ª—è —ç–ø–∏–∫–æ–≤, –∏ –¥–ª—è –∑–∞–¥–∞—á.

–§–æ—Ä–º–∞—Ç:
```typescript
interface EpicReorderMessage extends RealtimeBaseMessage {
  type: "epic_reorder";
  epicOrder: string[]; // –º–∞—Å—Å–∏–≤ epic.id –≤ –Ω–æ–≤–æ–º –ø–æ—Ä—è–¥–∫–µ
}

interface TaskReorderMessage extends RealtimeBaseMessage {
  type: "task_reorder";
  epicId: string;
  taskOrder: string[]; // –º–∞—Å—Å–∏–≤ task.id –≤ –Ω–æ–≤–æ–º –ø–æ—Ä—è–¥–∫–µ –≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–≥–æ —ç–ø–∏–∫–∞
}
```

### 11.4. Presence –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –º–µ–∂–¥—É —ç–ø–∏–∫–∞–º–∏

**–†–µ—à–µ–Ω–∏–µ:** `currentEpicId` –∏ `currentTaskId` –≤—Å–µ–≥–¥–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Ç–µ–∫—É—â–µ–º—É —Ñ–æ–∫—É—Å—É:
- –ü—Ä–∏ —Ñ–æ–∫—É—Å–µ –Ω–∞ –¥—Ä—É–≥–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è
- –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ñ–æ–∫—É—Å–∞ (blur –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø–æ–ª—è) –æ—á–∏—â–∞—é—Ç—Å—è

### 11.5. –§–æ—Ä–º–∞—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è "–∫—Ç–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç"

**–ê–≤–∞—Ç–∞—Ä:**
- –ö—Ä—É–≥–ª—ã–π –∞–≤–∞—Ç–∞—Ä —Å —Ñ–æ–Ω–æ–º = `color` –∏–∑ `PresencePayload`
- –¢–µ–∫—Å—Ç = –∏–Ω–∏—Ü–∏–∞–ª—ã:
  - –ï—Å–ª–∏ –µ—Å—Ç—å `displayName` ‚Üí –ø–µ—Ä–≤—ã–µ –±—É–∫–≤—ã –∏–º–µ–Ω–∏/—Ñ–∞–º–∏–ª–∏–∏
  - –ò–Ω–∞—á–µ ‚Äî –ø–µ—Ä–≤–∞—è –±—É–∫–≤–∞ email –¥–æ `@`
- Tooltip –ø–æ hover: `displayName` –∏–ª–∏ `email`

**–†–∞–∑–º–µ—â–µ–Ω–∏–µ:**
- **–≠–ø–∏–∫:** –≤ —à–∞–ø–∫–µ —ç–ø–∏–∫–∞, —Å–ø—Ä–∞–≤–∞ –æ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞, –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É; –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–≤–∞—Ç–∞—Ä–æ–∫ + "–µ—â—ë N"
- **–ó–∞–¥–∞—á–∞:** –≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä–æ–∫–∏ –∑–∞–¥–∞—á–∏, —Å–ø—Ä–∞–≤–∞ (–≤ –∫–æ–Ω—Ü–µ —Å—Ç—Ä–æ–∫–∏), –º–∞–ª–µ–Ω—å–∫–∏–µ –∞–≤–∞—Ç–∞—Ä–∫–∏; –µ—Å–ª–∏ –º–∞–ª–æ –º–µ—Å—Ç–∞ ‚Äî 1‚Äì2 –∞–≤–∞—Ç–∞—Ä–∫–∏ + "+N"

### 11.6. –ë–ª–æ–∫ "–°–µ–π—á–∞—Å –≤ –ø—Ä–æ–µ–∫—Ç–µ" –≤ UI

**–†–∞–∑–º–µ—â–µ–Ω–∏–µ:** –í —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∫–æ–º–ø–∞–∫—Ç–Ω–æ–π –≤–µ—Ä—Ö–Ω–µ–π –ø–∞–Ω–µ–ª–∏ (—Ç–∞–º –∂–µ, –≥–¥–µ –Ω–∞–∑–≤–∞–Ω–∏–µ/—Ç–∏–ø/–¥–∞—Ç–∞/—Å—Ç–µ–∫) –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

**–§–æ—Ä–º–∞—Ç:** `–°–µ–π—á–∞—Å –≤ –ø—Ä–æ–µ–∫—Ç–µ: [–∞–≤–∞—Ç–∞—Ä–∫–∏ –º–∞–∫—Å. 5] [+N]`

–ú–∞–∫—Å–∏–º—É–º 5 –∞–≤–∞—Ç–∞—Ä–æ–∫, –æ—Å—Ç–∞–ª—å–Ω—ã–µ ‚Äî –≤ "+N".

### 11.7. –û–±—Ä–∞–±–æ—Ç–∫–∞ project_meta_update

**–†–µ—à–µ–Ω–∏–µ:** –î–∞, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º `ProjectMeta` –≤ realtime:
- –Ω–∞–∑–≤–∞–Ω–∏–µ (`name`)
- –¥–∞—Ç–∞ (`date`)
- —Ç–∏–ø (`type`)
- —è–∑—ã–∫ (`language`)
- —Å—Ç–µ–∫ (`stack`)

**–í–∞–∂–Ω–æ:** –ò–∑–º–µ–Ω–µ–Ω–∏–µ `stack` —á–µ—Ä–µ–∑ realtime **–ù–ï —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—é —ç–ø–∏–∫–æ–≤** –Ω–∞ –¥—Ä—É–≥–∏—Ö –∫–ª–∏–µ–Ω—Ç–∞—Ö.

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–µ–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –ø—Ä–∏ —è–≤–Ω–æ–º –¥–µ–π—Å—Ç–≤–∏–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ / –æ—Ç–¥–µ–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞).

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —ç–ø–∏–∫–æ–≤/—Ç–∞—Å–∫–æ–≤ –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–¥—É—Ç —á–µ—Ä–µ–∑ –æ–±—ã—á–Ω—ã–µ patch-—Å–æ–æ–±—â–µ–Ω–∏—è.

–§–æ—Ä–º–∞—Ç:
```typescript
interface ProjectMetaUpdateMessage extends RealtimeBaseMessage {
  type: "project_meta_update";
  payload: Partial<ProjectMeta>;
}
```

### 11.8. –ò–Ω–¥–∏–∫–∞—Ü–∏—è "–ø–µ—á–∞—Ç–∞–µ—Ç" (isTyping)

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑—É–µ–º `isTyping` —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è –±–µ–π–¥–∂–∞ "–†–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç" / –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –∞–≤–∞—Ç–∞—Ä–∞.

–ë–µ–∑ –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö "..." –∏ —Å–ª–æ–∂–Ω—ã—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤.

**Debounce:**
- –ü—Ä–∏ –≤–≤–æ–¥–µ (keydown/input) —Å—Ä–∞–∑—É –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º `isTyping = true`
- –°—Ç–∞—Ä—Ç—É–µ–º —Ç–∞–π–º–µ—Ä (2 —Å–µ–∫—É–Ω–¥—ã); –µ—Å–ª–∏ –Ω–µ—Ç –Ω–æ–≤—ã—Ö —Å–æ–±—ã—Ç–∏–π –≤–≤–æ–¥–∞ ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º `isTyping = false`
- –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –º–∏–≥–∞–Ω–∏–µ –ø—Ä–∏ –ø–∞—É–∑–∞—Ö

### 11.9. –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

–í —Ä–∞–º–∫–∞—Ö –∑–∞–¥–∞—á–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å **–ø–æ–ª–Ω—ã–π –æ–±—ä—ë–º Realtime-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞** (presence, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π, –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, reorder –∏ –∞–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ).

–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
1. –ë–∞–∑–æ–≤—ã–π Realtime-—Å–ª–æ–π –∏ –ø–∞—Ç—á–∏ (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π)
   - –ö–∞–Ω–∞–ª, clientId, –æ—Ç–ø—Ä–∞–≤–∫–∞/–ø—Ä–∏—ë–º patch
2. Presence (–∫—Ç–æ –æ–Ω–ª–∞–π–Ω)
   - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–ª–æ–∫–∞ "–°–µ–π—á–∞—Å –≤ –ø—Ä–æ–µ–∫—Ç–µ"
3. –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (epic/task + isTyping)
4. –û–±—Ä–∞–±–æ—Ç–∫–∞ reorder (epic_reorder, task_reorder)
5. –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–µ

---

## 12. –ò—Ç–æ–≥–æ–≤—ã–π —á–µ–∫–ª–∏—Å—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- [ ] –•—É–∫ `useProjectRealtime` —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ –∫–∞–Ω–∞–ª—É
- [ ] –ö–æ–Ω—Ç–µ–∫—Å—Ç `ProjectCollabProvider` —Å presence –∏ –ø–∞—Ç—á–∞–º–∏
- [ ] –ì–µ–Ω–µ—Ä–∞—Ü–∏—è `clientId` —á–µ—Ä–µ–∑ `crypto.randomUUID()`
- [ ] Timestamp-–∫–∞—Ä—Ç—ã –¥–ª—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ (–≤ –ø–∞–º—è—Ç–∏)
- [ ] –û—Ç–ø—Ä–∞–≤–∫–∞ –∏ –ø—Ä–∏—ë–º –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π (create/update/delete/reorder)
- [ ] –ë–ª–æ–∫ "–°–µ–π—á–∞—Å –≤ –ø—Ä–æ–µ–∫—Ç–µ" –≤ –≤–µ—Ä—Ö–Ω–µ–π –ø–∞–Ω–µ–ª–∏ (–º–∞–∫—Å. 5 –∞–≤–∞—Ç–∞—Ä–æ–∫)
- [ ] –ê–≤–∞—Ç–∞—Ä–∫–∏ —Å –∏–Ω–∏—Ü–∏–∞–ª–∞–º–∏ –∏ —Ü–≤–µ—Ç–æ–º –≤ —ç–ø–∏–∫–∞—Ö
- [ ] –ê–≤–∞—Ç–∞—Ä–∫–∏ —Å –∏–Ω–∏—Ü–∏–∞–ª–∞–º–∏ –∏ —Ü–≤–µ—Ç–æ–º –≤ –∑–∞–¥–∞—á–∞—Ö
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ presence –ø—Ä–∏ —Ñ–æ–∫—É—Å–µ/–±–ª—é—Ä–µ
- [ ] Debounce –¥–ª—è `isTyping` (2 —Å–µ–∫)
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ `project_meta_update` –±–µ–∑ –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ `epic_reorder` –∏ `task_reorder`
- [ ] –ò–Ω–¥–∏–∫–∞—Ü–∏—è –ø–æ—Ç–µ—Ä–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- [ ] –†–µ–∫–æ–Ω–Ω–µ–∫—Ç —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º backoff
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `EstimatorApp` –∏ `EpicEditor`
